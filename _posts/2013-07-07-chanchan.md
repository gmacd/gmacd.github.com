---
layout: post
title: "ChanChan"
cover: cover.jpg
description: ""
comments: true
categories: [clojure, chanchan, jekyll]
date: 2013-07-07
---
I just spent the last 30 mins trying to get the Clojure code below to be nicely syntax highlighted in Jekyll. It turned out to require me to use the tag `highlight clojure` to mark the code to be highlighted.  Once that was done, it would silently fail to colour the text until I copied a css file for syntax highlighting that I had to download from somewhere, and put it in one of the several locations in my Jekyll/blog folder.

Not really the end of the world, but actually a bit comforting, since I decided to write my own static blog generator yesterday.

It's called ChanChan, named after my daughter's toy rabbit, because why not?  It's written in Clojure, because, again, why not?  Actually, there's more reason than that - I rather like Clojure, don't use it at work, and was looking for something to write with it.

It's very early days, but I plan on keeping a journal of the development here.  Currently, it assumes all posts are written in Markdown, and in the folder `assets/posts`.  It picks up all the `.md` files in that folder, converts them to html, and writes them to `site/posts`.

The code for this release can be found on [github](https://github.com/gmacd/chanchan/releases/tag/0.1), or you can see the the code in its entirity below.

``` clojure

(ns blog.core
  [:require [clojure.java.io :as jio]]
  [:use [markdown.core :only [md-to-html-string]]]
  [:use [hiccup core page]])

(def src-posts-path "assets/posts")
(def dest-posts-path "site/posts")

(defn html-post [title body]
  (html5 [:head
          [:link {:rel "stylesheet" :type "text/css" :href "../bootstrap/css/bootstrap.css"}]
          [:title title]]
         [:body body]))

(defn files-with-extension [src ext]
  "Return all files in src with the extension ext.  E.g. '.md'"
  (->> (jio/file src)
       (file-seq)
       (filter #(.endsWith (.getName %) ext))))

(defn with-ext [path ext]
  "Return a new file with the extension added or replaced with 'ext'"
  (let [period-idx (.lastIndexOf path ".")]
    (if (not= period-idx -1)
      (str (.substring path 0 period-idx) "." ext)
      (str path "." ext))))

(defn convert-md-file [src dest]
  (let [md-contents (slurp src)]
    (->> md-contents
         (md-to-html-string)
         (html-post "post?")
         (spit dest))))

(defn convert-all-md-files [src-path dest-path]
  (let [src (jio/file src-path)
        dest (jio/file dest-path)
        md-files (files-with-extension src-path ".md")]
    (doseq [md-file md-files]
      (let [dest-path (str dest-path "/" (with-ext (.getName md-file) "html"))]
        (convert-md-file md-file dest-path)))))
        
(defn -main [& args]
  ; Bit of a hack to create the folder - better way?
  (jio/make-parents (str dest-posts-path "/x"))
  (convert-all-md-files src-posts-path dest-posts-path))

```